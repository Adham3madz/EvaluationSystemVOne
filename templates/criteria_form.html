{% extends "layout.html" %}
{% block title %}{{ 'Ø¥Ø¶Ø§ÙØ©' if action == 'Add' else 'ØªØ¹Ø¯ÙŠÙ„' }} Ù…Ø¹ÙŠØ§Ø± ØªÙ‚ÙŠÙŠÙ…{% endblock %}

{% block content %}
<style>
  /* === Modern Optima HR Glassmorphism Styling === */
  :root {
    --glass-bg: rgba(255, 255, 255, 0.95);
    --glass-border: 1px solid rgba(255, 255, 255, 0.5);
    --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
    --primary-gradient: linear-gradient(135deg, #00d2ff 0%, #3a7bd5 100%);
    --text-dark: #2d3748;
    --text-muted: #718096;
  }

  /* Container & Layout */
  .page-container {
    max-width: 900px;
    margin: 40px auto;
    padding: 0 20px;
    animation: fadeIn 0.6s ease-out;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(20px);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Header Section */
  .form-header {
    text-align: center;
    margin-bottom: 30px;
    position: relative;
  }

  .form-header h2 {
    font-weight: 800;
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 10px;
    font-size: 2rem;
  }

  .form-header p {
    color: var(--text-muted);
    font-size: 1.1rem;
  }

  /* Glass Card */
  .glass-card {
    background: var(--glass-bg);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: var(--glass-border);
    box-shadow: var(--glass-shadow);
    border-radius: 20px;
    padding: 40px;
    position: relative;
    overflow: hidden;
  }

  /* Decorative Elements */
  .glass-card::before {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 100%;
    height: 5px;
    background: var(--primary-gradient);
  }

  /* Forms */
  .form-label {
    font-weight: 700;
    color: var(--text-dark);
    margin-bottom: 8px;
    font-size: 0.95rem;
    display: block;
  }

  .form-control,
  .form-select {
    background-color: #f8fafc;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    padding: 12px 16px;
    font-size: 1rem;
    transition: all 0.3s ease;
    color: #4a5568;
    width: 100%;
  }

  .form-control:focus,
  .form-select:focus {
    background-color: #fff;
    border-color: #3a7bd5;
    box-shadow: 0 0 0 4px rgba(58, 123, 213, 0.1);
    outline: none;
  }

  /* Input Icons */
  .input-icon-wrapper {
    position: relative;
  }

  .input-icon {
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
    color: #a0aec0;
    pointer-events: none;
  }

  .input-with-icon {
    padding-left: 45px;
  }

  /* Help Text */
  .form-text {
    font-size: 0.85rem;
    color: var(--text-muted);
    margin-top: 6px;
    font-style: italic;
  }

  /* Select2 Customization */
  .select2-container--default .select2-selection--multiple {
    border: 2px solid #e2e8f0 !important;
    border-radius: 12px !important;
    padding: 8px !important;
    min-height: 50px !important;
    background-color: #f8fafc !important;
  }

  .select2-container--default.select2-container--focus .select2-selection--multiple {
    border-color: #3a7bd5 !important;
    box-shadow: 0 0 0 4px rgba(58, 123, 213, 0.1) !important;
    background-color: #fff !important;
  }

  .select2-container--default .select2-selection--multiple .select2-selection__choice {
    background: var(--primary-gradient) !important;
    border: none !important;
    color: #fff !important;
    border-radius: 20px !important;
    padding: 4px 12px !important;
    font-size: 0.9rem !important;
    font-weight: 600 !important;
    margin-top: 4px !important;
  }

  .select2-container--default .select2-selection--multiple .select2-selection__choice__remove {
    color: #fff !important;
    margin-right: 8px !important;
    border-right: 1px solid rgba(255, 255, 255, 0.3) !important;
  }

  .select2-container--default .select2-selection--multiple .select2-selection__choice__remove:hover {
    background: rgba(0, 0, 0, 0.1) !important;
  }

  /* Action Buttons */
  .form-actions {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: 40px;
    padding-top: 20px;
    border-top: 1px solid #eef2f7;
  }

  .btn-custom {
    padding: 12px 30px;
    border-radius: 12px;
    font-weight: 700;
    font-size: 1rem;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    display: inline-flex;
    align-items: center;
    gap: 10px;
    border: none;
    cursor: pointer;
  }

  .btn-save {
    background: var(--primary-gradient);
    color: white;
    box-shadow: 0 4px 15px rgba(58, 123, 213, 0.3);
  }

  .btn-save:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(58, 123, 213, 0.4);
  }

  .btn-cancel {
    background: #e2e8f0;
    color: #4a5568;
  }

  .btn-cancel:hover {
    background: #cbd5e0;
    color: #2d3748;
  }

  /* Responsive Grid */
  .grid-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
  }

  @media (max-width: 768px) {
    .grid-row {
      grid-template-columns: 1fr;
      gap: 20px;
    }
  }
</style>

<div class="page-container">

  <div class="form-header">
    <h2>{{ 'âœ¨ Ø¥Ø¶Ø§ÙØ© Ù…Ø¹ÙŠØ§Ø± Ø¬Ø¯ÙŠØ¯' if action == 'Add' else 'ï¿½ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¹ÙŠØ§Ø±' }}</h2>
    <p>Ù‚Ù… {{ 'Ø¨Ø¥Ø¯Ø®Ø§Ù„' if action == 'Add' else 'Ø¨ØªØ­Ø¯ÙŠØ«' }} Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ÙŠØ§Ø± Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø¨Ø¯Ù‚Ø© Ù„Ø¶Ù…Ø§Ù† ÙƒÙØ§Ø¡Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</p>
  </div>

  <div class="glass-card">
    <form method="POST">

      <!-- Criterion Name -->
      <div class="mb-4">
        <label for="name" class="form-label">ğŸ“Œ Ø§Ø³Ù… Ø§Ù„Ù…Ø¹ÙŠØ§Ø± (Criterion Name)</label>
        <div class="input-icon-wrapper">
          <input type="text" id="name" name="name" class="form-control" required
            value="{{ criterion.CriteriaName if criterion else '' }}"
            placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ØŒ Ø¬ÙˆØ¯Ø© Ø§Ù„ÙƒÙˆØ¯ØŒ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠ...">
        </div>
      </div>

      <div class="grid-row mb-4">
        <!-- Weight -->
        <div>
          <label for="weight" class="form-label">âš–ï¸ Ø§Ù„ÙˆØ²Ù† Ø§Ù„Ù†Ø³Ø¨ÙŠ (Weight)</label>
          <input type="number" step="0.01" min="0.01" max="1.00" id="weight" name="weight" class="form-control" required
            value="{{ criterion.CriteriaWeight if criterion else '' }}" placeholder="Ù…Ø«Ø§Ù„: 0.20">
          <small class="form-text">ÙŠÙ…Ø«Ù„ Ù†Ø³Ø¨Ø© Ø§Ù„Ø£Ù‡Ù…ÙŠØ© Ù…Ù† 1.00 (Ù…Ø«Ù„Ø§Ù‹ 0.20 = 20%)</small>
        </div>

        <!-- Max Score -->
        <div>
          <label for="max_score" class="form-label">ğŸ’¯ Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø¹Ø¸Ù…Ù‰ (Max Score)</label>
          <input type="number" min="1" id="max_score" name="max_score" class="form-control" required
            value="{{ criterion.MaxScore if criterion else 10 }}">
          <small class="form-text">Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ù‚ØµÙˆÙ‰ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¨Ù†Ø¯ Ø¹Ù†Ø¯ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…</small>
        </div>
      </div>

      <!-- Departments Multi-Select -->
      <div class="mb-4">
        <label class="form-label">ğŸ¢ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù…Ø·Ø¨Ù‚ Ø¹Ù„ÙŠÙ‡Ø§ (Departments)</label>
        <select name="dept_ids" class="form-control select2" multiple="multiple" style="width: 100%;">

          <!-- General Option Logic -->
          {% set is_general = not selected_depts %}
          <option value="" {% if is_general %}selected{% endif %}>-- ğŸŒ Ø¹Ø§Ù… (ÙŠØ·Ø¨Ù‚ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…) --</option>

          {% for dept in departments or [] %}
          {% set d_id = dept.DEPTID | string %}
          <option value="{{ dept.DEPTID }}" {% if selected_depts and d_id in selected_depts %}selected{% endif %}>
            {{ dept.DEPTNAME }}
          </option>
          {% endfor %}
        </select>
        <small class="form-text">ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø± Ù‚Ø³Ù… ÙˆØ§Ø­Ø¯ØŒ Ø¹Ø¯Ø© Ø£Ù‚Ø³Ø§Ù…ØŒ Ø£Ùˆ "Ø¹Ø§Ù…" Ù„ØªØ·Ø¨ÙŠÙ‚Ù‡ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙƒØ© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„.</small>
      </div>

      <!-- Employee Class Multi-Select -->
      <div class="mb-4">
        <label class="form-label">ğŸ‘¥ Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„ÙˆØ¸ÙŠÙÙŠØ© (Employee Classes)</label>
        <select name="employee_levels" class="form-control select2" multiple="multiple" style="width: 100%;">
          {% for cls in classes %}
          <!-- We assume 'criterion' might pass 'employee_class' as a comma-string, handled in template -->
          {% set is_selected = false %}
          {% if criterion and criterion.employee_class and cls.ClassName in criterion.employee_class %}
          {% set is_selected = true %}
          {% endif %}

          <option value="{{ cls.ClassName }}" {% if is_selected %}selected{% endif %}>
            {{ cls.DisplayName or cls.ClassName }}
          </option>
          {% endfor %}
        </select>
        <small class="form-text">Ø³ÙŠØ¸Ù‡Ø± Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¹ÙŠØ§Ø± ÙÙ‚Ø· Ù„Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„ØªØ§Ø¨Ø¹ÙŠÙ† Ù„Ù„ÙØ¦Ø§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© Ù‡Ù†Ø§.</small>
      </div>

      <!-- Actions -->
      <div class="form-actions">
        <a href="{{ url_for('criteria_list') }}" class="btn-custom btn-cancel">
          ğŸš« Ø¥Ù„ØºØ§Ø¡
        </a>
        <button type="submit" class="btn-custom btn-save">
          {{ 'ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù…Ø¹ÙŠØ§Ø±' if action == 'Add' else 'ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª' }}
        </button>
      </div>

    </form>
  </div>
</div>

<!-- Select2 Initialization Script -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Initialize Select2 with Bootstrap 5 theme settings if available, or default
    $('.select2').select2({
      placeholder: "ğŸ” Ø§Ù†Ù‚Ø± Ù„Ù„Ø§Ø®ØªÙŠØ§Ø±...",
      allowClear: true,
      dir: "rtl",
      width: '100%',
      // Customizing the dropdown to match glass theme
      dropdownCssClass: 'glass-dropdown'
    });

    // Animation for form on load
    $('.glass-card').hide().fadeIn(500);
  });
</script>

{% endblock %}