{% extends "layout.html" %}
{% block title %}Ø³Ø¬Ù„ Ø§Ù„ØªÙˆØ¸ÙŠÙ{% endblock %}

{% block content %}
<script src="{{ url_for('static', filename='js/chart.min.js') }}"></script>

<style>
    /* === Glass Panel === */
    .glass-panel {
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px);
        border: 1px solid rgba(255, 255, 255, 0.5);
        border-radius: 16px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        padding: 20px;
        margin-bottom: 20px;
    }

    /* === Header === */
    .page-title {
        color: #fff;
        text-shadow: 0 2px 5px rgba(0, 0, 0, 0.4);
        font-weight: 800;
    }

    /* === KPI Cards === */
    .kpi-card {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(233, 236, 239, 0.6));
        border: 1px solid rgba(255, 255, 255, 0.6);
        border-radius: 16px;
        padding: 15px;
        text-align: center;
        transition: transform 0.2s;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
    }

    .kpi-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }

    .kpi-icon {
        font-size: 2rem;
        margin-bottom: 5px;
    }

    .kpi-value {
        font-size: 1.8rem;
        font-weight: 800;
        color: #333;
    }

    .kpi-label {
        font-size: 0.85rem;
        font-weight: 600;
        color: #666;
    }

    /* === Form Inputs === */
    .form-control,
    .form-select,
    .input-group-text {
        background: rgba(255, 255, 255, 0.6);
        border: 1px solid rgba(0, 0, 0, 0.1);
        color: #333;
    }

    .form-control:focus,
    .form-select:focus {
        background: #fff;
        box-shadow: 0 0 0 3px rgba(11, 102, 178, 0.2);
        border-color: #0b66b2;
    }

    /* === Buttons === */
    .btn-glass-primary {
        background: linear-gradient(135deg, #004d7a, #0b66b2);
        color: white;
        border: none;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }

    .btn-glass-primary:hover {
        background: #003d6a;
        color: white;
        transform: translateY(-2px);
    }

    .btn-glass-secondary {
        background: rgba(108, 117, 125, 0.8);
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(4px);
    }

    .btn-glass-secondary:hover {
        background: #5a6268;
        color: white;
    }

    /* === Table Styling === */
    .table-custom {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        margin-bottom: 0;
    }

    .table-custom thead th {
        background: linear-gradient(135deg, #212529, #343a40);
        color: #fff;
        padding: 15px;
        border: none;
        font-weight: 600;
        text-align: center;
    }

    .table-custom thead th:first-child {
        border-top-right-radius: 10px;
    }

    .table-custom thead th:last-child {
        border-top-left-radius: 10px;
    }

    .table-custom tbody td {
        background-color: transparent;
        padding: 12px;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        color: #333;
        vertical-align: middle;
    }

    .table-custom tbody tr:hover td {
        background-color: rgba(11, 102, 178, 0.08);
        /* Light Blue Highlight */
        transition: background-color 0.2s;
    }

    /* === Modal Glass === */
    .modal-content.glass-modal {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.4);
        border-radius: 20px;
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
    }
</style>

<div class="container-fluid py-4">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="page-title">ğŸ“œ Ø³Ø¬Ù„ Ø§Ù„ØªÙˆØ¸ÙŠÙ ÙˆØ§Ù„Ù…ØªØ§Ø¨Ø¹Ø©</h2>
            <p class="text-white-50">Ø³Ø¬Ù„ Ø´Ø§Ù…Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ­Ø±ÙƒØ§ØªØŒ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§ØªØŒ ÙˆØ§Ù„Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©.</p>
        </div>
        <div>
            <a href="{{ url_for('recruitment_settings') }}" class="btn btn-glass-secondary me-2">
                âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§Ø³ØªÙ‚Ø§Ù„Ø©
            </a>
            <a href="{{ url_for('recruitment_jobs') }}" class="btn btn-glass-primary">
                â¬…ï¸ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆØ¸Ø§Ø¦Ù
            </a>
        </div>
    </div>

    <div class="row g-4 mb-4">
        <div class="col-md-2">
            <div class="kpi-card">
                <div class="kpi-icon">ğŸ—‚ï¸</div>
                <div class="kpi-value" id="kpiTotal">0</div>
                <div class="kpi-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</div>
            </div>
        </div>

        <div class="col-md-2">
            <div class="kpi-card" style="border-color: rgba(25, 135, 84, 0.3);">
                <div class="kpi-icon">âœ…</div>
                <div class="kpi-value text-success" id="kpiHired">0</div>
                <div class="kpi-label">ØªÙ… ØªØ¹ÙŠÙŠÙ†Ù‡Ù…</div>
            </div>
        </div>

        <div class="col-md-2">
            <div class="kpi-card" style="border-color: rgba(220, 53, 69, 0.3);">
                <div class="kpi-icon">âŒ</div>
                <div class="kpi-value text-danger" id="kpiRejected">0</div>
                <div class="kpi-label">ØªÙ… Ø±ÙØ¶Ù‡Ù…</div>
            </div>
        </div>

        <div class="col-md-2">
            <div class="kpi-card" style="border-color: rgba(255, 193, 7, 0.3);">
                <div class="kpi-icon">ğŸšª</div>
                <div class="kpi-value text-warning" id="kpiResigned">0</div>
                <div class="kpi-label">Ø­Ø§Ù„Ø§Øª Ø§Ø³ØªÙ‚Ø§Ù„Ø©</div>
            </div>
        </div>

        <div class="col-md-2">
            <div class="glass-panel p-2 d-flex flex-column align-items-center justify-content-center h-100 mb-0">
                <h6 class="fw-bold small mb-2 text-muted">Ø§Ù„Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</h6>
                <div style="height: 80px; width: 80px;">
                    <canvas id="outcomeChart"></canvas>
                </div>
            </div>
        </div>

        <div class="col-md-2">
            <div class="glass-panel p-2 d-flex flex-column align-items-center justify-content-center h-100 mb-0">
                <h6 class="fw-bold small mb-2 text-muted">Ù†Ø´Ø§Ø· Ø§Ù„ÙˆØ¸Ø§Ø¦Ù</h6>
                <div style="height: 80px; width: 100%;">
                    <canvas id="jobsChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="glass-panel">
        <div class="row g-3">
            <div class="col-md-8">
                <div class="input-group">
                    <span class="input-group-text border-end-0">ğŸ”</span>
                    <input type="text" id="historySearch" class="form-control border-start-0 ps-0"
                        placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø´Ø­ØŒ Ø§Ù„ÙˆØ¸ÙŠÙØ©ØŒ Ø£Ùˆ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª...">
                </div>
            </div>
            <div class="col-md-4">
                <select id="statusFilter" class="form-select">
                    <option value="all">âš¡ Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</option>
                    <option value="Rejected">âŒ Ø§Ù„Ù…Ø±ÙÙˆØ¶ÙŠÙ†</option>
                    <option value="Hired">âœ… Ø§Ù„Ù…Ø¹ÙŠÙ†ÙŠÙ†</option>
                    <option value="Resigned">ğŸšª Ø§Ù„Ù…Ø³ØªÙ‚ÙŠÙ„ÙŠÙ†</option>
                </select>
            </div>
        </div>
    </div>

    <div class="glass-panel p-0 overflow-hidden d-flex flex-column" style="height: calc(100vh - 350px);">
        <div class="table-responsive flex-grow-1" style="overflow-y: auto;">
            <table class="table table-custom text-center" id="historyTable">
                <thead style="position: sticky; top: 0; z-index: 10;">
                    <tr>
                        <th class="py-3 shadow-sm">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                        <th class="shadow-sm">Ø§Ù„Ù…Ø±Ø´Ø­</th>
                        <th class="shadow-sm">Ø§Ù„ÙˆØ¸ÙŠÙØ©</th>
                        <th class="shadow-sm">Ø§Ù„Ù‚Ø³Ù…</th>
                        <th class="shadow-sm">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ (Ø§Ù„Ø­Ø§Ù„Ø©)</th>
                        <th class="shadow-sm">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                        <th class="shadow-sm">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    {% for log in logs %}
                    <tr class="history-row" data-status="{{ log.ToStage }}" data-job="{{ log.JobTitle }}">

                        <td class="small text-muted">
                            <div class="fw-bold text-dark">ğŸ“… {{ log.ActionDate.strftime('%Y-%m-%d') }}</div>
                            <div>ğŸ•’ {{ log.ActionDate.strftime('%H:%M') }}</div>
                        </td>

                        <td class="fw-bold text-primary search-term">
                            ğŸ‘¤ {{ log.FullName }}
                        </td>

                        <td class="search-term">
                            {{ log.JobTitle }}
                        </td>

                        <td>
                            <span class="badge bg-light text-dark border">
                                ğŸ¢ {{ log.DEPTNAME or 'Ø¹Ø§Ù…' }}
                            </span>
                        </td>

                        <td>
                            <span class="badge bg-secondary opacity-50 text-white">{{ log.FromStage }}</span>
                            <span class="mx-1 text-muted">â¬…ï¸</span>
                            {% if log.ToStage == 'Rejected' %}
                            <span class="badge bg-danger">âŒ Ù…Ø±ÙÙˆØ¶</span>
                            {% elif log.ToStage == 'Hired' %}
                            <span class="badge bg-success">âœ… ØªÙ… Ø§Ù„ØªØ¹ÙŠÙŠÙ†</span>
                            {% elif log.ToStage == 'Resigned' %}
                            <span class="badge bg-warning text-dark border border-warning">ğŸšª Ø§Ø³ØªÙ‚Ø§Ù„Ø©</span>
                            {% else %}
                            <span class="badge bg-primary">{{ log.ToStage }}</span>
                            {% endif %}
                        </td>

                        <td class="text-start search-term" style="max-width: 250px;">
                            {% if log.Note %}
                            <div class="p-1 small text-truncate" style="max-width: 250px;" title="{{ log.Note }}">
                                ğŸ“ {{ log.Note }}
                            </div>
                            {% else %}
                            <span class="text-muted small">-</span>
                            {% endif %}
                        </td>

                        <td>
                            <div class="btn-group shadow-sm" style="border-radius: 6px; overflow: hidden;">
                                <button class="btn btn-sm btn-light border"
                                    onclick="openDetailsModal('{{ log.FullName }}', '{{ log.Phone }}', '{{ log.Email }}', '{{ log.JobTitle }}', '{{ log.DEPTNAME or 'Ø¹Ø§Ù…' }}')"
                                    title="Ø§Ù„ØªÙØ§ØµÙŠÙ„">
                                    ğŸ‘ï¸
                                </button>

                                <button class="btn btn-sm btn-light border text-danger"
                                    onclick="openResignModal('{{ log.CandidateID }}', '{{ log.FullName }}')"
                                    title="ØªØ³Ø¬ÙŠÙ„ Ø§Ø³ØªÙ‚Ø§Ù„Ø©">
                                    ğŸšª
                                </button>

                                {% if log.CurrentStatus != 'Archived' %}
                                <form action="{{ url_for('archive_candidate') }}" method="POST" class="d-inline"
                                    onsubmit="return confirm('Ø£Ø±Ø´ÙØ© Ù‡Ø°Ø§ Ø§Ù„Ù…Ø±Ø´Ø­ØŸ');">
                                    <input type="hidden" name="candidate_id" value="{{ log.CandidateID }}">
                                    <input type="hidden" name="note" value="Archived from History List">
                                    <button type="submit" class="btn btn-sm btn-light border text-secondary"
                                        title="Ø£Ø±Ø´ÙØ©">
                                        ğŸ“¦
                                    </button>
                                </form>
                                {% endif %}
                            </div>
                        </td>

                    </tr>
                    {% else %}
                    <tr id="noDataRow">
                        <td colspan="7" class="text-center py-5 text-muted">
                            <div class="fs-1 mb-2">ğŸ“­</div>
                            Ø§Ù„Ø³Ø¬Ù„ ÙØ§Ø±Øº Ø­Ø§Ù„ÙŠØ§Ù‹.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="modal fade" id="detailsModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content glass-modal border-0">
            <div class="modal-header bg-info text-white border-0" style="border-radius: 20px 20px 0 0;">
                <h5 class="modal-title">ğŸ“‹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø±Ø´Ø­</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-4">
                <div class="text-center mb-4">
                    <div class="bg-light rounded-circle d-inline-flex align-items-center justify-content-center shadow-sm"
                        style="width: 80px; height: 80px;">
                        <span class="fs-1">ğŸ‘¤</span>
                    </div>
                    <h4 id="detailName" class="fw-bold mt-2 text-dark"></h4>
                </div>

                <ul class="list-group list-group-flush bg-transparent">
                    <li class="list-group-item d-flex justify-content-between bg-transparent border-bottom">
                        <span class="text-muted">ğŸ’¼ Ø§Ù„ÙˆØ¸ÙŠÙØ©:</span>
                        <span class="fw-bold text-dark" id="detailJob"></span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between bg-transparent border-bottom">
                        <span class="text-muted">ğŸ¢ Ø§Ù„Ù‚Ø³Ù…:</span>
                        <span class="fw-bold text-dark" id="detailDept"></span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between bg-transparent border-bottom">
                        <span class="text-muted">ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ:</span>
                        <span class="fw-bold text-dark" id="detailPhone"></span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between bg-transparent">
                        <span class="text-muted">ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯:</span>
                        <span class="fw-bold text-dark" id="detailEmail"></span>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="resignModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <form class="modal-content glass-modal border-0" method="POST" action="{{ url_for('submit_resignation') }}">
            <div class="modal-header bg-danger text-white border-0" style="border-radius: 20px 20px 0 0;">
                <h5 class="modal-title">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ø³ØªÙ‚Ø§Ù„Ø© / Ø®Ø±ÙˆØ¬</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-4">
                <input type="hidden" name="candidate_id" id="resignCandidateId">
                <div class="alert alert-warning border-0 text-center shadow-sm mb-4">
                    Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù†Ù‡Ø§Ø¡ Ø®Ø¯Ù…Ø§Øª <strong id="resignName"></strong>ØŸ
                </div>

                <div class="mb-3">
                    <label class="fw-bold mb-2">ğŸ“Œ Ù†ÙˆØ¹ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø®Ø¯Ù…Ø©</label>
                    <select name="termination_type_id" id="resignTypeSelect" class="form-select" required
                        onchange="filterReasons()">
                        <option value="" selected disabled>-- Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹ --</option>
                        {% for type in types %}
                        <option value="{{ type.TypeID }}">{{ type.TypeText }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="mb-3">
                    <label class="fw-bold mb-2">ğŸ“ Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</label>
                    <select name="termination_reason_id" id="resignReasonSelect" class="form-select" required disabled>
                        <option value="" selected disabled>-- Ø§Ø®ØªØ± Ø§Ù„Ù†ÙˆØ¹ Ø£ÙˆÙ„Ø§Ù‹ --</option>
                        <!-- Options populated by JS -->
                    </select>
                    <div class="form-text">
                        <a href="{{ url_for('recruitment_settings') }}" target="_blank" class="text-decoration-none">â•
                            Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³Ù…ÙŠØ§Øª ÙˆØ§Ù„Ø£Ø³Ø¨Ø§Ø¨</a>
                    </div>
                </div>

                <div class="mb-3">
                    <label class="fw-bold mb-2">ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</label>
                    <textarea name="notes" class="form-control" rows="3"
                        placeholder="ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)..."></textarea>
                </div>
            </div>
            <div class="modal-footer border-0 justify-content-center pb-4">
                <button type="button" class="btn btn-secondary px-4" data-bs-dismiss="modal">Ø¥Ù„ØºØ§Ø¡</button>
                <button type="submit" class="btn btn-danger px-4 fw-bold">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</button>
            </div>
        </form>
    </div>
</div>

<script>
    // Embed reasons data for JS filtering
    const allReasons = [
        {% for reason in reasons %}
    { id: "{{ reason.ReasonID }}", typeId: "{{ reason.TypeID }}", text: "{{ reason.ReasonText }}" },
    {% endfor %}
    ];

    function filterReasons() {
        const typeId = document.getElementById('resignTypeSelect').value;
        const reasonSelect = document.getElementById('resignReasonSelect');

        // Clear current options
        reasonSelect.innerHTML = '<option value="" selected disabled>-- Ø§Ø®ØªØ± Ø§Ù„Ø³Ø¨Ø¨ --</option>';

        if (!typeId) {
            reasonSelect.disabled = true;
            return;
        }

        // Filter reasons
        const filtered = allReasons.filter(r => r.typeId === typeId);

        if (filtered.length > 0) {
            filtered.forEach(r => {
                const opt = document.createElement('option');
                opt.value = r.id;
                opt.textContent = r.text;
                reasonSelect.appendChild(opt);
            });
            reasonSelect.disabled = false;
        } else {
            const opt = document.createElement('option');
            opt.textContent = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¨Ø§Ø¨ Ù…Ø³Ø¬Ù„Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù†ÙˆØ¹";
            reasonSelect.appendChild(opt);
            reasonSelect.disabled = true;
        }
    }
</script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // === 1. Calculate Analytics from Table ===
        let total = 0, hired = 0, rejected = 0, resigned = 0;
        const jobCounts = {};

        const rows = document.querySelectorAll('.history-row');

        rows.forEach(row => {
            total++;
            const status = row.getAttribute('data-status');
            const job = row.getAttribute('data-job') || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';

            if (status === 'Hired') hired++;
            else if (status === 'Rejected') rejected++;
            else if (status === 'Resigned') resigned++;

            // Count Job Activity
            jobCounts[job] = (jobCounts[job] || 0) + 1;
        });

        // Update KPI Numbers
        document.getElementById('kpiTotal').innerText = total;
        document.getElementById('kpiHired').innerText = hired;
        document.getElementById('kpiRejected').innerText = rejected;
        document.getElementById('kpiResigned').innerText = resigned;

        if (total === 0) return;

        // --- Chart 1: Outcomes (Doughnut) ---
        new Chart(document.getElementById('outcomeChart'), {
            type: 'doughnut',
            data: {
                labels: ['ØªØ¹ÙŠÙŠÙ†', 'Ø±ÙØ¶', 'Ø§Ø³ØªÙ‚Ø§Ù„Ø©', 'Ø£Ø®Ø±Ù‰'],
                datasets: [{
                    data: [hired, rejected, resigned, total - hired - rejected - resigned],
                    backgroundColor: ['#198754', '#dc3545', '#ffc107', '#6c757d'],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                cutout: '65%'
            }
        });

        // --- Chart 2: Jobs (Bar - Top 5) ---
        const sortedJobs = Object.entries(jobCounts).sort((a, b) => b[1] - a[1]).slice(0, 5);
        new Chart(document.getElementById('jobsChart'), {
            type: 'bar',
            data: {
                labels: sortedJobs.map(i => i[0]),
                datasets: [{
                    label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª',
                    data: sortedJobs.map(i => i[1]),
                    backgroundColor: '#0d6efd',
                    borderRadius: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { display: false },
                    y: { display: false, beginAtZero: true }
                }
            }
        });
    });

    // === 2. Filter Logic (Existing) ===
    const searchInput = document.getElementById('historySearch');
    const statusFilter = document.getElementById('statusFilter');
    const tableRows = document.querySelectorAll('.history-row');

    function filterTable() {
        const searchText = searchInput.value.toLowerCase();
        const statusValue = statusFilter.value;

        tableRows.forEach(row => {
            const textContent = row.innerText.toLowerCase();
            const matchesSearch = textContent.includes(searchText);
            const rowStatus = row.getAttribute('data-status');

            let matchesStatus = true;
            if (statusValue === 'Rejected') matchesStatus = (rowStatus === 'Rejected');
            else if (statusValue === 'Hired') matchesStatus = (rowStatus === 'Hired');
            else if (statusValue === 'Resigned') matchesStatus = (rowStatus === 'Resigned');

            if (matchesSearch && matchesStatus) row.style.display = '';
            else row.style.display = 'none';
        });
    }

    searchInput.addEventListener('keyup', filterTable);
    statusFilter.addEventListener('change', filterTable);

    // === 3. Modal Logic (Existing) ===
    function openDetailsModal(name, phone, email, job, dept) {
        document.getElementById('detailName').innerText = name;
        document.getElementById('detailPhone').innerText = phone;
        document.getElementById('detailEmail').innerText = email || 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
        document.getElementById('detailJob').innerText = job;
        document.getElementById('detailDept').innerText = dept;
        new bootstrap.Modal(document.getElementById('detailsModal')).show();
    }

    function openResignModal(id, name) {
        document.getElementById('resignCandidateId').value = id;
        document.getElementById('resignName').innerText = name;
        new bootstrap.Modal(document.getElementById('resignModal')).show();
    }
</script>

{% endblock %}