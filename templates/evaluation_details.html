<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <title>ØªÙ‚Ø±ÙŠØ± ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø¯Ø§Ø¡ - {{ eval.EmployeeName }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/cairo.css') }}">
    <style>
        /* === Screen Styles === */
        body {
            background-color: #f0f2f5;
            font-family: "Cairo", sans-serif;
            color: #1e293b;
        }

        .print-container {
            max-width: 210mm;
            margin: 20px auto;
            padding: 30px;
            background-color: #ffffff;
            border: 1px solid #d1d5db;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #0f172a;
            padding-bottom: 15px;
        }

        .logo-box {
            font-weight: 800;
            font-size: 24px;
            color: #0f172a;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .report-title {
            text-align: center;
            flex-grow: 1;
        }

        .report-title h2 {
            font-size: 22px;
            font-weight: 800;
            color: #0f172a;
            margin: 0;
        }

        .report-title p {
            margin: 0;
            color: #64748b;
            font-size: 14px;
        }

        /* Info Grid */
        .info-box {
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            gap: 20px;
        }

        .profile-img {
            width: 100px;
            height: 100px;
            border-radius: 8px;
            border: 2px solid #cbd5e1;
            object-fit: cover;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px 30px;
            flex-grow: 1;
        }

        .info-item {
            font-size: 14px;
            display: flex;
            align-items: baseline;
        }

        .info-label {
            font-weight: 700;
            color: #475569;
            width: 100px;
            margin-left: 10px;
        }

        .info-val {
            font-weight: 600;
            color: #0f172a;
        }

        /* Tables */
        .table-custom {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            margin-bottom: 15px;
        }

        .table-custom th,
        .table-custom td {
            border: 1px solid #cbd5e1;
            padding: 6px 10px;
        }

        .table-custom thead th {
            background-color: #0f172a;
            color: white;
            border-color: #0f172a;
            text-align: center;
        }

        .table-custom tbody tr:nth-child(even) {
            background-color: #f8fafc;
        }

        .text-end {
            text-align: right;
        }

        .text-center {
            text-align: center;
        }

        /* Section Headers */
        .section-title {
            font-size: 14px;
            font-weight: 800;
            color: #0f172a;
            background: #e2e8f0;
            padding: 6px 10px;
            border-radius: 4px;
            margin-bottom: 8px;
            border-right: 4px solid #0f172a;
        }

        /* Print Optimization */
        @media print {
            @page {
                size: A4;
                margin: 8mm;
            }

            body {
                background: white;
                -webkit-print-color-adjust: exact;
            }

            .print-container {
                width: 100%;
                max-width: 100%;
                margin: 0;
                padding: 0;
                border: none;
                box-shadow: none;
            }

            .no-print {
                display: none !important;
            }

            .report-header {
                margin-bottom: 10px;
                padding-bottom: 10px;
            }

            .info-box {
                padding: 8px;
                margin-bottom: 10px;
                border: 1px solid #94a3b8;
            }

            .profile-img {
                width: 80px;
                height: 80px;
            }

            .info-grid {
                font-size: 11px;
                gap: 5px 15px;
            }

            .table-custom {
                font-size: 10px;
                margin-bottom: 10px;
            }

            .table-custom th,
            .table-custom td {
                padding: 4px 6px;
                border-color: #64748b;
            }

            .section-title {
                font-size: 12px;
                padding: 4px 8px;
                margin-bottom: 5px;
                background: #f1f5f9 !important;
                border-color: #0f172a !important;
                color: #000 !important;
            }

            .signature-section {
                margin-top: 15px;
                page-break-inside: avoid;
            }

            p,
            div {
                color: #000 !important;
            }
        }
    </style>
</head>

<body>

    <div class="print-container">

        <!-- Actions (No Print) -->
        <div class="no-print d-flex justify-content-between mb-4">
            <a href="{{ url_for('evaluation_reports') }}" class="btn btn-outline-secondary">â¬…ï¸ Ø±Ø¬ÙˆØ¹</a>
            <button onclick="window.print()" class="btn btn-primary fw-bold">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
        </div>

        <!-- Header -->
        <div class="report-header">
            <div class="report-title">
                <h2>ØªÙ‚Ø±ÙŠØ± ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</h2>
                <p>Ù‚Ø³Ù… Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ© - Ù†Ù…ÙˆØ°Ø¬ ØªÙ‚ÙŠÙŠÙ… Ø±Ø³Ù…ÙŠ</p>
            </div>
            <div class="logo-box">
                <img src="{{ url_for('static', filename='images/optima_logo.png') }}" style="height: 50px;" alt="Logo"
                    onerror="this.style.display='none'">
            </div>
        </div>

        <!-- Employee Info -->
        <div class="info-box">
            <img src="{{ url_for('user_pic', user_id=eval.EmployeeUserID) }}" class="profile-img" alt="Photo"
                onerror="this.src='{{ url_for('static', filename='images/default_user.png') }}'">
            <div class="info-grid">
                <div class="info-item"><span class="info-label">Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù:</span> <span class="info-val">{{
                        eval.EmployeeName }}</span></div>
                <div class="info-item"><span class="info-label">Ø§Ù„Ù…Ø³Ù…Ù‰:</span> <span class="info-val">{{
                        eval.EmployeeTitle or '-' }}</span></div>
                <div class="info-item"><span class="info-label">Ø§Ù„Ù‚Ø³Ù…:</span> <span class="info-val">{{
                        eval.EmployeeDeptName or '-' }}</span></div>
                <div class="info-item"><span class="info-label">Ø§Ù„ÙØ¦Ø©:</span> <span class="info-val">{{
                        eval.employee_class or '-' }}</span></div>
                <div class="info-item"><span class="info-label">Ø§Ù„ØªØ§Ø±ÙŠØ®:</span> <span class="info-val">{{
                        eval.EvaluationDate.strftime('%Y-%m-%d') }}</span></div>
                <div class="info-item"><span class="info-label">Ø§Ù„Ù…ÙÙ‚ÙŠÙ‘Ù…:</span> <span class="info-val">{{
                        eval.EvaluatorName }}</span></div>
            </div>
        </div>

        <!-- Details Table -->
        <div class="section-title">ğŸ“Š ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ±</div>
        <table class="table-custom">
            <thead>
                <tr>
                    <th width="40%">Ø§Ù„Ù…Ø¹ÙŠØ§Ø±</th>
                    <th width="15%">Ø§Ù„ÙˆØ²Ù†</th>
                    <th width="15%">Ø§Ù„Ø¹Ø¸Ù…Ù‰</th>
                    <th width="15%">Ø§Ù„Ø¯Ø±Ø¬Ø©</th>
                    <th width="15%">Ø§Ù„Ù†Ø³Ø¨Ø©</th>
                </tr>
            </thead>
            <tbody>
                {% set total_weighted_score = namespace(value=0.0) %}
                {% set total_weight = namespace(value=0.0) %}
                {% for item in details %}
                <tr>
                    <td class="text-end">{{ item.CriteriaName }}</td>
                    <td class="text-center">{{ "%.0f%%"|format(item.CriteriaWeight|float * 100) }}</td>
                    <td class="text-center">{{ item.MaxScore }}</td>
                    <td class="text-center fw-bold">{{ item.ScoreGiven }}</td>
                    {% set item_weighted_score = (item.ScoreGiven / item.MaxScore) * item.CriteriaWeight|float if
                    item.MaxScore > 0 else 0 %}
                    <td class="text-center">{{ "%.1f"|format(item_weighted_score * 100) }}%</td>
                    {% set total_weighted_score.value = total_weighted_score.value + item_weighted_score %}
                    {% set total_weight.value = total_weight.value + item.CriteriaWeight|float %}
                </tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr style="background-color: #e2e8f0; font-weight: bold;">
                    <td colspan="4" class="text-end">Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©:</td>
                    {% set final_percentage = (total_weighted_score.value / total_weight.value) * 100 if
                    total_weight.value > 0 else 0 %}
                    <td class="text-center">{{ "%.2f"|format(final_percentage) }}%</td>
                </tr>
            </tfoot>
        </table>

        <div
            style="background: #f1f5f9; padding: 10px; border-radius: 6px; text-align: center; border: 1px solid #cbd5e1; margin-bottom: 20px;">
            <span style="color: #64748b;">Ø§Ù„ØªÙ‚Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…:</span>
            <strong style="color: #0f172a; font-size: 1.2em; margin-right: 10px;">{{ eval.OverallRating }} ({{
                "%.1f"|format(eval.OverallScore) }}%)</strong>
        </div>

        <!-- Notes & Recommendations -->
        <div class="row g-3">
            {% if eval.ManagerComments %}
            <div class="col-12">
                <div class="section-title">ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù…Ø¯ÙŠØ±</div>
                <div
                    style="padding: 10px; border: 1px solid #cbd5e1; border-radius: 4px; font-size: 13px; background: #fff;">
                    {{ eval.ManagerComments }}
                </div>
            </div>
            {% endif %}

            {% if eval.RecommendationText %}
            <div class="col-6">
                <div class="section-title">ğŸ’¡ Ø§Ù„ØªÙˆØµÙŠØ©</div>
                <div
                    style="padding: 10px; border: 1px solid #cbd5e1; border-radius: 4px; font-size: 13px; background: #fff; min-height: 40px;">
                    {{ eval.RecommendationText }}
                </div>
            </div>
            {% endif %}

            {% if eval.TrainingCourseText %}
            <div class="col-6">
                <div class="section-title">ğŸ¯ Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©</div>
                <div
                    style="padding: 10px; border: 1px solid #cbd5e1; border-radius: 4px; font-size: 13px; background: #fff; min-height: 40px;">
                    {{ eval.TrainingCourseText }}
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Courses History (New) -->
        {% if eval.CoursesTaken %}
        <div style="margin-top: 15px;">
            <div class="section-title">ğŸ“š Ø³Ø¬Ù„ Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ© (History)</div>
            <div
                style="padding: 10px; border: 1px solid #cbd5e1; border-radius: 4px; font-size: 12px; background: #f8fafc; color: #334155;">
                {% set courses = eval.CoursesTaken.split('###') %}
                {{ courses|join(' ØŒ ') }}
            </div>
        </div>
        {% endif %}

        <!-- Signatures -->
        <div class="signature-section" style="margin-top: 40px;">
            <div class="row text-center">
                <div class="col-6">
                    <p style="font-weight: bold; margin-bottom: 40px;">ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸Ù</p>
                    <p>..............................</p>
                </div>
                <div class="col-6">
                    <p style="font-weight: bold; margin-bottom: 40px;">ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø¯ÙŠØ± / Ø§Ù„Ù…Ù‚ÙŠÙ…</p>
                    <p>..............................</p>
                </div>
            </div>
        </div>

    </div>

</body>

</html>