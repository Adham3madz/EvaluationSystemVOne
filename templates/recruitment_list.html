{% extends "layout.html" %}
{% block title %}Ø³Ø¬Ù„ Ø§Ù„ØªÙˆØ¸ÙŠÙ{% endblock %}

{% block content %}
<style>
    /* === Page Header === */
    .page-header {
        background: linear-gradient(135deg, #2c3e50, #3498db);
        color: white;
        padding: 25px;
        border-radius: 12px;
        text-align: center;
        margin-bottom: 30px;
        box-shadow: 0 4px 15px rgba(52, 152, 219, 0.2);
    }
    .page-header h2 { font-weight: 800; margin: 0; font-size: 28px; }
    .page-header p { opacity: 0.9; margin-top: 5px; font-size: 15px; }

    /* === Filter Section === */
    .filter-card {
        background: #fff;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        margin-bottom: 25px;
        border: 1px solid #f0f2f5;
    }
    .filter-form {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        align-items: flex-end;
    }
    .filter-item {
        flex: 1;
        min-width: 180px;
    }
    .filter-label {
        font-weight: 700;
        font-size: 12px;
        color: #666;
        margin-bottom: 5px;
        display: block;
    }
    .filter-control {
        width: 100%;
        padding: 10px 12px;
        border-radius: 8px;
        border: 1px solid #e0e0e0;
        font-size: 14px;
        background-color: #fafafa;
    }
    .filter-control:focus {
        background-color: #fff;
        border-color: #3498db;
        outline: none;
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
    }

    /* === Action Bar === */
    .action-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 15px;
    }
    
    /* === Buttons === */
    .btn-custom {
        padding: 10px 20px;
        border-radius: 50px;
        font-weight: 700;
        font-size: 14px;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s ease;
        border: none;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .btn-add { background: linear-gradient(135deg, #27ae60, #2ecc71); color: white; }
    .btn-add:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(39, 174, 96, 0.3); color: white; }
    .btn-import { background: linear-gradient(135deg, #f39c12, #f1c40f); color: white; }
    .btn-import:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(243, 156, 18, 0.3); color: white; }
    .btn-dashboard { background: linear-gradient(135deg, #8e44ad, #9b59b6); color: white; }
    .btn-dashboard:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(142, 68, 173, 0.3); color: white; }
    .btn-search { background: #3498db; color: white; width: 100%; }
    .btn-reset { background: #e0e0e0; color: #333; width: 100%; text-align: center; }

    /* === Table Card === */
    .table-card {
        background: #fff;
        border-radius: 16px;
        box-shadow: 0 5px 25px rgba(0,0,0,0.06);
        padding: 0;
        overflow: hidden;
        border: 1px solid #e9ecef;
    }
    
    .table-responsive { overflow-x: auto; }
    
    /* === Modern Table === */
    .table { vertical-align: middle; width: 100%; border-collapse: collapse; }
    .table thead th {
        background-color: #f8f9fa;
        color: #555;
        font-weight: 700;
        border-bottom: 2px solid #e9ecef;
        padding: 15px 20px;
        font-size: 13px;
        white-space: nowrap;
    }
    .table tbody td {
        padding: 15px 20px;
        color: #444;
        border-bottom: 1px solid #f1f1f1;
        font-size: 14px;
    }
    .table tbody tr:hover { background-color: #f9fbfd; }
    .table tbody tr:last-child td { border-bottom: none; }

    /* === Status Badges === */
    .status-badge {
        padding: 6px 14px;
        border-radius: 30px;
        font-size: 12px;
        font-weight: 700;
        text-transform: uppercase;
        display: inline-block;
    }
    .bg-new { background-color: #e3f2fd; color: #0d47a1; border: 1px solid #bbdefb; }
    .bg-screen { background-color: #f3e5f5; color: #7b1fa2; border: 1px solid #e1bee7; }
    .bg-interview { background-color: #fff8e1; color: #f57f17; border: 1px solid #ffecb3; }
    .bg-offer { background-color: #e0f2f1; color: #00695c; border: 1px solid #b2dfdb; }
    .bg-hired { background-color: #d1e7dd; color: #0f5132; border: 1px solid #c3e6cb; }
    .bg-rejected { background-color: #f8d7da; color: #842029; border: 1px solid #f5c6cb; }

    .info-icon { color: #95a5a6; margin-left: 5px; width: 16px; text-align: center; }
    .location-text { color: #666; font-size: 13px; display: flex; align-items: center; gap: 5px; }

    .action-btn {
        width: 35px;
        height: 35px;
        border-radius: 8px;
        background-color: #f1f3f5;
        color: #495057;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        transition: 0.2s;
    }
    .action-btn:hover { background-color: #3498db; color: white; }
</style>

<div class="page-header">
    <h2>ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„ØªÙˆØ¸ÙŠÙ</h2>
    <p>Ø¥Ø¯Ø§Ø±Ø© Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±Ø´Ø­ÙŠÙ†ØŒ Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø§ØªØŒ ÙˆØ­Ø§Ù„Ø© Ø§Ù„ØªÙˆØ¸ÙŠÙ</p>
</div>

<div class="filter-card">
    <form method="GET" action="{{ url_for('recruitment_list') }}" class="filter-form">
        
        <div class="filter-item" style="flex: 2;">
            <label class="filter-label">Ø¨Ø­Ø« (Ø§Ù„Ø§Ø³Ù… / Ø§Ù„Ù‡Ø§ØªÙ / SSN)</label>
            <input type="text" name="search" class="filter-control" placeholder="Ø§ÙƒØªØ¨ Ù„Ù„Ø¨Ø­Ø«..." value="{{ filters.get('search', '') }}">
        </div>

        <div class="filter-item">
            <label class="filter-label">Ø§Ù„Ù‚Ø³Ù…</label>
            <select name="dept_id" class="filter-control">
                <option value="">Ø§Ù„ÙƒÙ„</option>
                {% for d in depts %}
                <option value="{{ d.DEPTID }}" {% if filters.get('dept_id') == d.DEPTID|string %}selected{% endif %}>{{ d.DEPTNAME }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="filter-item">
            <label class="filter-label">Ø§Ù„ÙˆØ¸ÙŠÙØ©</label>
            <select name="pos_id" class="filter-control">
                <option value="">Ø§Ù„ÙƒÙ„</option>
                {% for p in positions %}
                <option value="{{ p.PositionID }}" {% if filters.get('pos_id') == p.PositionID|string %}selected{% endif %}>{{ p.PositionName }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="filter-item">
            <label class="filter-label">Ø§Ù„Ø­Ø§Ù„Ø©</label>
            <select name="status" class="filter-control">
                <option value="">Ø§Ù„ÙƒÙ„</option>
                <option value="New" {% if filters.get('status') == 'New' %}selected{% endif %}>Ø¬Ø¯ÙŠØ¯</option>
                <option value="Screening" {% if filters.get('status') == 'Screening' %}selected{% endif %}>ÙØ±Ø²</option>
                <option value="Interview" {% if filters.get('status') == 'Interview' %}selected{% endif %}>Ù…Ù‚Ø§Ø¨Ù„Ø©</option>
                <option value="Offer" {% if filters.get('status') == 'Offer' %}selected{% endif %}>Ø¹Ø±Ø¶ Ø¹Ù…Ù„</option>
                <option value="Hired" {% if filters.get('status') == 'Hired' %}selected{% endif %}>ØªÙ… Ø§Ù„ØªØ¹ÙŠÙŠÙ†</option>
                <option value="Rejected" {% if filters.get('status') == 'Rejected' %}selected{% endif %}>Ù…Ø±ÙÙˆØ¶</option>
            </select>
        </div>

        <div class="filter-item">
            <label class="filter-label">Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
            <input type="date" name="date_from" class="filter-control" value="{{ filters.get('date_from', '') }}">
        </div>
        <div class="filter-item">
            <label class="filter-label">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
            <input type="date" name="date_to" class="filter-control" value="{{ filters.get('date_to', '') }}">
        </div>

        <div class="filter-item" style="flex: 0 0 auto; min-width: auto;">
            <label class="filter-label">&nbsp;</label>
            <button type="submit" class="btn-custom btn-search">
                <i class="fa-solid fa-filter"></i> ØªØµÙÙŠØ©
            </button>
        </div>
        
        {% if filters|length > 0 %}
        <div class="filter-item" style="flex: 0 0 auto; min-width: auto;">
            <label class="filter-label">&nbsp;</label>
            <a href="{{ url_for('recruitment_list') }}" class="btn-custom btn-reset">
                <i class="fa-solid fa-rotate-right"></i>
            </a>
        </div>
        {% endif %}
    </form>
</div>

<div class="action-bar">
    <div></div>
    <div style="display:flex; gap:10px;">
        <a href="{{ url_for('recruitment_dashboard') }}" class="btn-custom btn-dashboard">
            <i class="fa-solid fa-chart-pie"></i> Ø§Ù„ØªØ­Ù„ÙŠÙ„
        </a>
        <a href="{{ url_for('recruitment_import') }}" class="btn-custom btn-import">
            <i class="fa-solid fa-file-import"></i> Ø§Ø³ØªÙŠØ±Ø§Ø¯
        </a>
        <a href="{{ url_for('recruitment_add') }}" class="btn-custom btn-add">
            <i class="fa-solid fa-user-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ø±Ø´Ø­
        </a>
    </div>
</div>

<div class="table-card">
    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø´Ø­</th>
                    <th>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù‚ÙˆÙ…ÙŠ / Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
                    <th>Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©</th>
                    <th>ØªÙˆØ§Ø±ÙŠØ® Ù‡Ø§Ù…Ø©</th>
                    <th class="text-center">Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</th>
                    <th class="text-center">Ø¥Ø¬Ø±Ø§Ø¡</th>
                </tr>
            </thead>
            <tbody>
                {% for c in candidates %}
                <tr>
                    <td>
                        <div class="d-flex align-items-center">
                            <div style="width: 40px; height: 40px; background: #e3f2fd; color: #004d7a; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-left: 12px; font-size:18px;">
                                {{ c.FullName[:1] }}
                            </div>
                            <div>
                                <div style="font-weight: 700; color: #2c3e50; font-size: 15px;">{{ c.FullName }}</div>
                                <div style="font-size: 12px; color: #777; margin-top: 3px;">
                                    <i class="fa-solid fa-phone info-icon"></i> {{ c.Phone }}
                                </div>
                            </div>
                        </div>
                    </td>

                    <td>
                        <div style="font-weight: 600; color: #333; font-size: 13px;">
                            <i class="fa-regular fa-id-card info-icon" style="color: #3498db;"></i> 
                            {{ c.SSN or 'Ù„Ù… ÙŠØ³Ø¬Ù„' }}
                        </div>
                        <div class="location-text" style="margin-top: 5px;">
                            <i class="fa-solid fa-location-dot info-icon" style="color: #e74c3c;"></i> 
                            {{ c.Address or 'Ù…ØµØ±' }}
                        </div>
                    </td>

                    <td>
                        <span style="background: #f0f3f5; padding: 4px 10px; border-radius: 6px; font-size: 12px; font-weight: 600; color: #444;">
                            {{ c.PositionName or 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}
                        </span>
                        <div style="font-size: 12px; color: #888; margin-top: 5px; padding-right: 5px;">
                            <i class="fa-solid fa-building info-icon"></i> {{ c.DEPTNAME or 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}
                        </div>
                    </td>

                    <td>
                        <div style="font-size: 13px; color: #555;">
                            <i class="fa-regular fa-calendar info-icon"></i> {{ c.ApplicationDate }}
                        </div>
                    </td>

                    <td class="text-center">
                        {% set s_class = 'bg-new' %}
                        {% set s_icon = 'fa-circle' %}
                        {% if c.Status == 'Screening' %}{% set s_class = 'bg-screen' %}{% set s_icon = 'fa-filter' %}
                        {% elif c.Status == 'Interview' %}{% set s_class = 'bg-interview' %}{% set s_icon = 'fa-comments' %}
                        {% elif c.Status == 'Offer' %}{% set s_class = 'bg-offer' %}{% set s_icon = 'fa-file-signature' %}
                        {% elif c.Status == 'Hired' %}{% set s_class = 'bg-hired' %}{% set s_icon = 'fa-check' %}
                        {% elif c.Status == 'Rejected' %}{% set s_class = 'bg-rejected' %}{% set s_icon = 'fa-xmark' %}
                        {% endif %}
                        
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 5px;">
                            <span class="status-badge {{ s_class }}">
                                <i class="fa-solid {{ s_icon }}" style="margin-left: 5px;"></i> {{ c.Status }}
                            </span>
                            
                            {% if c.Notes %}
                            <span data-bs-toggle="tooltip" data-bs-placement="top" title="{{ c.Notes }}">
                                <i class="fa-regular fa-comment-dots" style="color: #7f8c8d; font-size: 16px; cursor: help;"></i>
                            </span>
                            {% endif %}
                        </div>
                    </td>

                    <td class="text-center">
                        <a href="{{ url_for('recruitment_edit', cid=c.CandidateID) }}" class="action-btn" title="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø©">
                            <i class="fa-solid fa-pen"></i>
                        </a>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="6" class="text-center py-5">
                        <div style="color: #ccc; font-size: 40px; margin-bottom: 10px;"><i class="fa-solid fa-folder-open"></i></div>
                        <h4 style="color: #777; font-size: 16px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¨Ø­Ø«</h4>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl)
    })
</script>
{% endblock %}