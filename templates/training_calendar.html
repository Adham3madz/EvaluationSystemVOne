{% extends "layout.html" %}
{% block title %}ØªÙ‚ÙˆÙŠÙ… Ø§Ù„ØªØ¯Ø±ÙŠØ¨{% endblock %}

{% block content %}
<style>
    /* === Glass Panel === */
    .glass-panel {
        background: rgba(255, 255, 255, 0.85); /* Milky White Glass */
        backdrop-filter: blur(15px);
        -webkit-backdrop-filter: blur(15px);
        border: 1px solid rgba(255, 255, 255, 0.5);
        border-radius: 16px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        padding: 25px;
        height: 100%; /* Ensure panels match height */
    }

    /* === Page Title === */
    .page-title {
        color: #fff;
        text-shadow: 0 2px 5px rgba(0,0,0,0.4);
        font-weight: 800;
        margin-bottom: 25px;
    }

    /* === Form Inputs (Glassy) === */
    .form-label {
        font-weight: 700;
        color: #444;
        font-size: 0.9rem;
    }

    .form-control, .form-select {
        background: rgba(255, 255, 255, 0.6);
        border: 1px solid rgba(0,0,0,0.1);
        border-radius: 8px;
        color: #333;
        transition: all 0.3s;
    }

    .form-control:focus, .form-select:focus {
        background: #fff;
        box-shadow: 0 0 0 3px rgba(11, 102, 178, 0.2);
        border-color: #0b66b2;
    }

    /* === Custom FullCalendar Styling for Glass Theme === */
    #calendar {
        max-width: 100%;
        margin: 0 auto;
        font-family: 'Tajawal', sans-serif;
    }

    /* Toolbar Buttons */
    .fc .fc-button-primary {
        background: linear-gradient(135deg, #004d7a, #0b66b2);
        border: none;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        font-weight: bold;
    }
    
    .fc .fc-button-primary:hover {
        background: #003d6a;
        transform: translateY(-1px);
    }

    .fc .fc-button-primary:not(:disabled).fc-button-active {
        background: #002b45;
    }

    /* Calendar Header & Text */
    .fc .fc-toolbar-title {
        color: #0b66b2;
        font-weight: 800;
        font-size: 1.2rem;
    }

    .fc .fc-col-header-cell-cushion {
        color: #444; /* Day names color */
        padding: 10px 0;
    }

    .fc .fc-daygrid-day-number {
        color: #555;
        font-weight: bold;
        text-decoration: none;
    }

    /* Events */
    .fc-event {
        border-radius: 4px;
        border: none;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        cursor: pointer;
        transition: transform 0.1s;
    }
    .fc-event:hover {
        transform: scale(1.02);
    }
</style>

<div class="container-fluid py-4">

    <h3 class="page-title">ğŸ“… ØªÙ‚ÙˆÙŠÙ… Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙˆØ§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª</h3>

    <div class="row g-4">
        <div class="col-lg-4 col-md-12">
            <div class="glass-panel">
                <h5 class="fw-bold mb-4 text-primary border-bottom pb-2">â• Ø¬Ø¯ÙˆÙ„Ø© Ø¬Ù„Ø³Ø© Ø¬Ø¯ÙŠØ¯Ø©</h5>
                
                <form action="{{ url_for('training_add_event') }}" method="POST">
                    <div class="row g-3">
                        <div class="col-12">
                            <label class="form-label">Ø§Ù„Ø¯ÙˆØ±Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ¨ÙŠØ©</label>
                            <select name="course_id" class="form-select" required>
                                <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø¯ÙˆØ±Ø© --</option>
                                {% for c in courses %}
                                    <option value="{{ c.TrainingCourseID }}">{{ c.TrainingCourseText }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="col-12">
                            <label class="form-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</label>
                            <input type="date" name="start_date" class="form-control" required>
                        </div>
                        
                        <div class="col-12">
                            <label class="form-label">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                            <input type="date" name="end_date" class="form-control">
                        </div>
                        
                        <div class="col-12">
                            <label class="form-label">Ø§Ù„Ù…ÙˆÙ‚Ø¹</label>
                            <input type="text" name="location" class="form-control" placeholder="Ù…Ø«Ø§Ù„: Ù‚Ø§Ø¹Ø© Ø§Ù„ØªØ¯Ø±ÙŠØ¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©" required>
                        </div>
                        
                        <div class="col-12">
                            <label class="form-label">Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¯Ø±Ø¨</label>
                            <select name="trainer_type" class="form-select" required onchange="toggleTrainerFields()">
                                <option value="internal">Ø¯Ø§Ø®Ù„ÙŠ</option>
                                <option value="external">Ø®Ø§Ø±Ø¬ÙŠ</option>
                            </select>
                        </div>
                        
                        <div class="col-12" id="internalTrainerDiv">
                            <label class="form-label">Ø§Ù„Ù…Ø¯Ø±Ø¨ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ</label>
                            <select name="instructor_id" class="form-select">
                                <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯Ø±Ø¨ --</option>
                                {% for i in instructors %}
                                    <option value="{{ i.UserID }}">{{ i.Name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="col-12" id="externalNameDiv" style="display:none;">
                            <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø¨ Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ</label>
                            <input type="text" name="ext_name" class="form-control">
                        </div>
                        
                        <div class="col-12" id="externalCompanyDiv" style="display:none;">
                            <label class="form-label">Ø§Ù„Ø´Ø±ÙƒØ©</label>
                            <input type="text" name="ext_company" class="form-control">
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary w-100 mt-4 fw-bold shadow-sm">
                        ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¬Ù„Ø³Ø©
                    </button>
                </form>
            </div>
        </div>

        <div class="col-lg-8 col-md-12">
            <div class="glass-panel">
                <div id="calendar"></div>
            </div>
        </div>
    </div>
</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/locales/ar.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        locale: 'ar',
        direction: 'rtl',
        height: 'auto',
        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        buttonText: {
            today: 'Ø§Ù„ÙŠÙˆÙ…',
            month: 'Ø´Ù‡Ø±',
            week: 'Ø£Ø³Ø¨ÙˆØ¹',
            day: 'ÙŠÙˆÙ…',
            list: 'Ù‚Ø§Ø¦Ù…Ø©'
        },
        events: '/api/training/events',
        eventColor: '#0b66b2', // Match system theme
        eventClick: function(info) {
            info.jsEvent.preventDefault();
            if (info.event.url) {
                window.location.href = info.event.url;
            }
        }
    });
    calendar.render();
});

function toggleTrainerFields() {
    var type = document.querySelector('[name="trainer_type"]').value;
    document.getElementById('internalTrainerDiv').style.display = type === 'internal' ? 'block' : 'none';
    document.getElementById('externalNameDiv').style.display = type === 'external' ? 'block' : 'none';
    document.getElementById('externalCompanyDiv').style.display = type === 'external' ? 'block' : 'none';
}
</script>

{% endblock %}