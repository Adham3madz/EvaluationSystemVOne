{% extends "layout.html" %}
{% block title %}ğŸ“ˆ ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„ØªÙˆØ¸ÙŠÙ ÙˆØ§Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©{% endblock %}

{% block content %}
<style>
    /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
    .analytics-header {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        padding: 35px;
        border-radius: 18px;
        margin-bottom: 35px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }
    .analytics-header h2 { 
        margin: 0; 
        font-weight: 800; 
        font-size: 26px; 
    }
    .analytics-header p { 
        margin: 8px 0 0; 
        opacity: 0.9; 
        font-size: 15px;
    }

    /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
    .kpi-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 25px;
        margin-bottom: 40px;
    }
    .kpi-card {
        background: #fff;
        padding: 28px;
        border-radius: 16px;
        box-shadow: 0 6px 18px rgba(0,0,0,0.08);
        display: flex;
        align-items: center;
        justify-content: space-between;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .kpi-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 12px 25px rgba(0,0,0,0.12);
    }
    .kpi-info .kpi-value { 
        font-size: 3rem; 
        font-weight: 900; 
        color: #2c3e50; 
        margin: 0; 
        line-height: 1;
    }
    .kpi-info .kpi-label { 
        color: #7f8c8d; 
        font-weight: 600; 
        font-size: 15px; 
        margin-top: 6px;
    }
    .kpi-emoji { 
        font-size: 60px; 
        opacity: 0.25; 
    }

    /* Ù‚Ø³Ù… Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© */
    .future-section {
        background: #fff;
        padding: 30px;
        border-radius: 18px;
        box-shadow: 0 6px 18px rgba(0,0,0,0.08);
        margin-bottom: 40px;
    }
    .section-title { 
        font-weight: 800; 
        color: #2c3e50; 
        margin-bottom: 25px; 
        font-size: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .timeline-list {
        max-height: 500px;
        overflow-y: auto;
    }
    .timeline-item {
        display: flex;
        gap: 20px;
        padding: 18px 0;
        border-bottom: 1px dashed #eee;
        transition: background 0.2s;
    }
    .timeline-item:hover { 
        background: #f8fbff; 
        border-radius: 12px; 
        padding: 18px;
        margin: 0 -18px;
    }
    .timeline-date {
        min-width: 80px;
        text-align: center;
        background: #e3f2fd;
        color: #1976d2;
        padding: 12px 8px;
        border-radius: 14px;
        font-weight: bold;
    }
    .day { font-size: 22px; line-height: 1; }
    .month { font-size: 13px; text-transform: uppercase; letter-spacing: 1px; }

    .timeline-content h5 { 
        margin: 0 0 6px; 
        font-weight: 700; 
        color: #333; 
        font-size: 17px;
    }
    .timeline-content p { 
        margin: 0 0 8px; 
        color: #555; 
        font-size: 14px;
    }
    .badge-int1 { 
        background: #fff3cd; 
        color: #856404; 
        padding: 4px 10px; 
        border-radius: 8px; 
        font-size: 12px; 
        font-weight: 600;
    }
    .badge-int2 { 
        background: #d1ecf1; 
        color: #0c5460; 
        padding: 4px 10px; 
        border-radius: 8px; 
        font-size: 12px; 
        font-weight: 600;
    }

    /* Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© */
    .charts-row {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 30px;
    }
    .chart-card {
        background: #fff;
        padding: 30px;
        border-radius: 18px;
        box-shadow: 0 6px 18px rgba(0,0,0,0.08);
    }
    .chart-card h5 {
        text-align: center;
        color: #2c3e50;
        margin-bottom: 25px;
        font-weight: 700;
        font-size: 18px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
    }

        /* Ù…Ù†Ø¹ Ø§Ù„Ù‚ÙØ² Ø£Ùˆ Ø§Ù„Ù€ flow down Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© */
    .chart-container, .chart-box, .chart-card {
        min-height: 400px; /* Ø§Ø±ØªÙØ§Ø¹ Ø«Ø§Ø¨Øª Ø­ØªÙ‰ Ù„Ùˆ Ø§Ù„Ø±Ø³Ù… Ù„Ø³Ø© Ø¨ÙŠØªØ­Ù…Ù„ */
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
    }

    canvas {
        max-height: 350px !important;
        width: 100% !important;
    }

    /* Ø¥Ø¸Ù‡Ø§Ø± loader Ø¨Ø³ÙŠØ· Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„ÙƒÙ† Ø¬Ù…ÙŠÙ„) */
    .chart-box::before {
        content: "â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ...";
        position: absolute;
        font-size: 18px;
        color: #999;
        display: none;
    }
    .chart-box:empty::before {
        display: block;
    }

    /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù€ KPI cards Ø¹Ø´Ø§Ù† Ù…Ø§ ØªØªØ­Ø±ÙƒØ´ */
    .kpi-grid {
        min-height: 150px;
    }

    .no-interviews {
        text-align: center;
        padding: 50px 20px;
        color: #95a5a6;
        font-size: 17px;
    }
    .no-interviews emoji {
        font-size: 60px;
        display: block;
        margin-bottom: 15px;
        opacity: 0.6;
    }

    @media (max-width: 992px) {
        .charts-row { grid-template-columns: 1fr; }
        .analytics-header { flex-direction: column; text-align: center; gap: 15px; }
    }
</style>

<div class="analytics-header">
    <div>
        <h2>ğŸ“ˆ ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„ØªÙˆØ¸ÙŠÙ ÙˆØ§Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©</h2>
        <p>Ù†Ø¸Ø±Ø© Ø´Ø§Ù…Ù„Ø© ÙˆÙˆØ¯ÙŠØ© Ø¹Ù„Ù‰ Ø£Ø¯Ø§Ø¡ Ø§Ù„ØªÙˆØ¸ÙŠÙ ÙˆØ§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</p>
    </div>
    <div>
        <a href="{{ url_for('recruitment_list') }}" class="btn btn-light fw-bold px-4 py-2">
            ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø±Ø´Ø­ÙŠÙ†
        </a>
    </div>
</div>

<!-- KPIs -->
<div class="kpi-row">
    <div class="kpi-card" style="border-bottom-color: #3498db;">
        <div class="kpi-info">
            <p class="kpi-value">{{ total }}</p>
            <span class="kpi-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…ÙŠÙ†</span>
        </div>
        <div class="kpi-emoji" style="color: #3498db;">ğŸ‘¥</div>
    </div>

    <div class="kpi-card" style="border-bottom-color: #27ae60;">
        <div class="kpi-info">
            <p class="kpi-value">{{ hired }}</p>
            <span class="kpi-label">ØªÙ… Ø§Ù„ØªØ¹ÙŠÙŠÙ†</span>
        </div>
        <div class="kpi-emoji" style="color: #27ae60;">âœ…</div>
    </div>

    <div class="kpi-card" style="border-bottom-color: #e74c3c;">
        <div class="kpi-info">
            <p class="kpi-value">{{ rejected }}</p>
            <span class="kpi-label">ØªÙ… Ø§Ù„Ø±ÙØ¶</span>
        </div>
        <div class="kpi-emoji" style="color: #e74c3c;">âŒ</div>
    </div>
</div>

<!-- Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© -->
<div class="future-section">
    <h3 class="section-title">ğŸ“… Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</h3>
    
    <div class="timeline-list">
        {% if upcoming %}
            {% for int in upcoming %}
            <div class="timeline-item">
                <div class="timeline-date">
                    <div class="day">{{ int.InterviewDate.day }}</div>
                    <div class="month">{{ int.InterviewDate.strftime('%b') }}</div>
                </div>
                <div class="timeline-content">
                    <h5>{{ int.FullName }}</h5>
                    <p>ğŸ’¼ {{ int.PositionName or 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}</p>
                    <div style="margin-top: 8px;">
                        {% if int.Stage == 'Interview 1' %}
                            <span class="badge-int1">ğŸ‘¤ Ù…Ù‚Ø§Ø¨Ù„Ø© Ø£ÙˆÙ„Ù‰ (HR)</span>
                        {% else %}
                            <span class="badge-int2">ğŸ› ï¸ Ù…Ù‚Ø§Ø¨Ù„Ø© Ø«Ø§Ù†ÙŠØ© (ÙÙ†ÙŠØ©)</span>
                        {% endif %}
                        <span style="color: #666; margin-right: 12px;">
                            ğŸ‘¤ Ù…Ø¹: {{ int.Interviewer or 'Ù„Ù… ÙŠÙØ­Ø¯Ø¯ Ø¨Ø¹Ø¯' }}
                        </span>
                    </div>
                </div>
                <div>
                    <a href="{{ url_for('recruitment_edit', cid=int.CandidateID) }}" class="btn btn-sm btn-outline-primary">
                        âœï¸ ØªÙØ§ØµÙŠÙ„
                    </a>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="no-interviews">
                <div class="emoji">ğŸ—“ï¸</div>
                <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‚Ø§Ø¨Ù„Ø§Øª Ù…Ø¬Ø¯ÙˆÙ„Ø© ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©.</p>
                <p style="font-size:14px; margin-top:10px;">Ø§Ø³ØªÙ…ØªØ¹ Ø¨Ø§Ù„Ù‡Ø¯ÙˆØ¡ Ù…Ø¤Ù‚ØªÙ‹Ø§! â˜•</p>
            </div>
        {% endif %}
    </div>
</div>

<!-- Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© -->
<div class="charts-row">
    <div class="chart-card">
        <h5>ğŸ”½ Ù‚Ù…Ø¹ Ø§Ù„ØªÙˆØ¸ÙŠÙ (Hiring Funnel)</h5>
        <canvas id="funnelChart"></canvas>
    </div>
    <div class="chart-card">
        <h5>ğŸ¢ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù…</h5>
        <canvas id="deptChart"></canvas>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const data = JSON.parse('{{ analytics_data|safe }}');

    // Ù‚Ù…Ø¹ Ø§Ù„ØªÙˆØ¸ÙŠÙ (Ø´Ø±ÙŠØ· Ø£ÙÙ‚ÙŠ Ù„ØªØ£Ø«ÙŠØ± Ø§Ù„Ù‚Ù…Ø¹)
    new Chart(document.getElementById('funnelChart'), {
        type: 'bar',
        data: {
            labels: data.funnel_labels,
            datasets: [{
                label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø´Ø­ÙŠÙ†',
                data: data.funnel_counts,
                backgroundColor: ['#3498db', '#9b59b6', '#f39c12', '#e67e22', '#27ae60'],
                borderRadius: 8,
                borderSkipped: false
            }]
        },
        options: {
            indexAxis: 'y',
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: { rtl: true }
            },
            scales: {
                x: { beginAtZero: true, ticks: { stepSize: 1 } }
            }
        }
    });

    // Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù… (Ø¯Ø§Ø¦Ø±Ø©)
    new Chart(document.getElementById('deptChart'), {
        type: 'doughnut',
        data: {
            labels: data.dept_labels,
            datasets: [{
                data: data.dept_counts,
                backgroundColor: ['#2c3e50', '#3498db', '#9b59b6', '#e74c3c', '#f39c12', '#27ae60', '#95a5a6'],
                borderWidth: 3,
                borderColor: '#fff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { position: 'bottom', labels: { padding: 20 } }
            }
        }
    });
});
</script>

{% endblock %}