{% extends "layout.html" %}
{% block title %}ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙˆØ¸ÙŠÙ ÙˆØ§Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©{% endblock %}

{% block content %}
<style>
    /* Header */
    .analytics-header {
        background: linear-gradient(135deg, #141E30, #243B55);
        color: white;
        padding: 30px;
        border-radius: 16px;
        margin-bottom: 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    }
    .analytics-header h2 { margin: 0; font-weight: 800; font-size: 24px; }

    /* KPI Cards */
    .kpi-row {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
        margin-bottom: 30px;
    }
    .kpi-card {
        background: #fff;
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        display: flex;
        align-items: center;
        justify-content: space-between;
        border-bottom: 4px solid #ddd;
    }
    .kpi-value { font-size: 2.5rem; font-weight: 800; color: #333; margin: 0; }
    .kpi-label { color: #777; font-weight: 600; font-size: 14px; }
    .kpi-icon { font-size: 40px; opacity: 0.2; }

    /* Future View (Timeline) */
    .future-section {
        background: #fff;
        padding: 30px;
        border-radius: 16px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        margin-bottom: 30px;
    }
    .section-title { 
        font-weight: 800; color: #2c3e50; margin-bottom: 20px; 
        border-right: 5px solid #3498db; padding-right: 15px;
    }
    
    .timeline-item {
        display: flex;
        gap: 20px;
        padding: 15px;
        border-bottom: 1px solid #f1f1f1;
        transition: 0.3s;
    }
    .timeline-item:hover { background: #f8f9fa; }
    .timeline-date {
        min-width: 90px;
        text-align: center;
        background: #e3f2fd;
        color: #0d47a1;
        padding: 10px;
        border-radius: 10px;
        font-weight: bold;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }
    .day { font-size: 18px; line-height: 1; }
    .month { font-size: 12px; text-transform: uppercase; }
    
    .timeline-content h5 { margin: 0 0 5px; font-weight: 700; color: #333; }
    .timeline-content p { margin: 0; font-size: 13px; color: #666; }
    .badge-int1 { background: #fff3cd; color: #856404; padding: 2px 8px; border-radius: 4px; font-size: 11px; }
    .badge-int2 { background: #d1e7dd; color: #0f5132; padding: 2px 8px; border-radius: 4px; font-size: 11px; }

    /* Charts */
    .charts-row {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 20px;
    }
    .chart-card {
        background: #fff;
        padding: 25px;
        border-radius: 16px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
    }

    @media (max-width: 768px) {
        .kpi-row, .charts-row { grid-template-columns: 1fr; }
    }
</style>

<div class="analytics-header">
    <div>
        <h2>ğŸ“ˆ ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„ØªÙˆØ¸ÙŠÙ ÙˆØ§Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©</h2>
        <p style="margin:5px 0 0; opacity:0.8;">Ù†Ø¸Ø±Ø© Ø´Ø§Ù…Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙˆØ§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</p>
    </div>
    <div>
        <a href="{{ url_for('recruitment_list') }}" class="btn btn-light text-dark fw-bold">
            <i class="fa-solid fa-arrow-right"></i> Ø³Ø¬Ù„ Ø§Ù„Ù…Ø±Ø´Ø­ÙŠÙ†
        </a>
    </div>
</div>

<div class="kpi-row">
    <div class="kpi-card" style="border-color: #3498db;">
        <div>
            <p class="kpi-value">{{ total }}</p>
            <span class="kpi-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…ÙŠÙ†</span>
        </div>
        <i class="fa-solid fa-users kpi-icon text-primary"></i>
    </div>
    <div class="kpi-card" style="border-color: #2ecc71;">
        <div>
            <p class="kpi-value">{{ hired }}</p>
            <span class="kpi-label">ØªÙ… Ø§Ù„ØªØ¹ÙŠÙŠÙ† (Hired)</span>
        </div>
        <i class="fa-solid fa-user-check kpi-icon text-success"></i>
    </div>
    <div class="kpi-card" style="border-color: #e74c3c;">
        <div>
            <p class="kpi-value">{{ rejected }}</p>
            <span class="kpi-label">ØªÙ… Ø§Ù„Ø±ÙØ¶</span>
        </div>
        <i class="fa-solid fa-user-xmark kpi-icon text-danger"></i>
    </div>
</div>

<div class="future-section">
    <h3 class="section-title">ğŸ“… Ø§Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ©: Ø§Ù„Ù…Ù‚Ø§Ø¨Ù„Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</h3>
    
    <div class="timeline-list">
        {% for int in upcoming %}
        <div class="timeline-item">
            <div class="timeline-date">
                <span class="day">{{ int.InterviewDate.day }}</span>
                <span class="month">{{ int.InterviewDate.strftime('%b') }}</span>
            </div>
            <div class="timeline-content">
                <h5>{{ int.FullName }}</h5>
                <p><i class="fa-solid fa-briefcase"></i> {{ int.PositionName }}</p>
                <div style="margin-top: 5px;">
                    {% if int.Stage == 'Interview 1' %}
                        <span class="badge-int1">Ù…Ù‚Ø§Ø¨Ù„Ø© Ø£ÙˆÙ„Ù‰ (HR)</span>
                    {% else %}
                        <span class="badge-int2">Ù…Ù‚Ø§Ø¨Ù„Ø© Ø«Ø§Ù†ÙŠØ© (Tech)</span>
                    {% endif %}
                    <span class="text-muted ms-2"><i class="fa-solid fa-user-tie"></i> Ù…Ø¹: {{ int.Interviewer or 'Ù„Ù… ÙŠØ­Ø¯Ø¯' }}</span>
                </div>
            </div>
            <div style="margin-right: auto; align-self: center;">
                <a href="{{ url_for('recruitment_edit', cid=int.CandidateID) }}" class="btn btn-sm btn-outline-primary">ØªÙØ§ØµÙŠÙ„</a>
            </div>
        </div>
        {% else %}
        <div class="text-center py-4 text-muted">
            <i class="fa-regular fa-calendar-check fa-2x mb-2"></i><br>
            Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‚Ø§Ø¨Ù„Ø§Øª Ù…Ø¬Ø¯ÙˆÙ„Ø© ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ Ø§Ù„Ù‚Ø±ÙŠØ¨.
        </div>
        {% endfor %}
    </div>
</div>

<div class="charts-row">
    <div class="chart-card">
        <h5 class="mb-4">Ù‚Ù…Ø¹ Ø§Ù„ØªÙˆØ¸ÙŠÙ (Hiring Funnel)</h5>
        <canvas id="funnelChart" height="100"></canvas>
    </div>
    <div class="chart-card">
        <h5 class="mb-4">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù…</h5>
        <canvas id="deptChart" height="200"></canvas>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const data = JSON.parse('{{ analytics_data|safe }}');

    // 1. Funnel Chart (Bar)
    new Chart(document.getElementById('funnelChart'), {
        type: 'bar',
        data: {
            labels: data.funnel_labels,
            datasets: [{
                label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø±Ø´Ø­ÙŠÙ†',
                data: data.funnel_counts,
                backgroundColor: [
                    '#3498db', // New
                    '#9b59b6', // Screening
                    '#f1c40f', // Interview
                    '#e67e22', // Offer
                    '#2ecc71'  // Hired
                ],
                borderRadius: 5
            }]
        },
        options: {
            indexAxis: 'y', // Horizontal Bar for Funnel effect
            plugins: { legend: { display: false } },
            scales: { x: { beginAtZero: true } }
        }
    });

    // 2. Dept Chart (Doughnut)
    new Chart(document.getElementById('deptChart'), {
        type: 'doughnut',
        data: {
            labels: data.dept_labels,
            datasets: [{
                data: data.dept_counts,
                backgroundColor: ['#2c3e50', '#34495e', '#7f8c8d', '#bdc3c7', '#ecf0f1']
            }]
        },
        options: {
            plugins: { legend: { position: 'bottom' } }
        }
    });
});
</script>

{% endblock %}